<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <!-- página HTML -->
<h1>Minha Lista de Filmes</h1>

<form id="form-add-movie">
  <label for="input-movie-title">Título do Filme:</label><br>
  <input type="text" id="input-movie-title"><br>
  <button type="submit">Adicionar Filme</button>
</form>

<div id="movie-list"></div>

<script>
  // verifica se o Local Storage está disponível
  if (window.localStorage) {
    console.log('Local Storage disponível');
  } else {
    console.log('Local Storage não disponível');
  }

  // sua chave de API do OMDb
  const apiKey = '70374582';

  // obtém a referência ao formulário e ao elemento div da lista de filmes
  const form = document.querySelector('#form-add-movie');
  const movieListDiv = document.querySelector('#movie-list');

  // carrega a lista de filmes do Local Storage quando a página é carregada
  let movies = JSON.parse(localStorage.getItem('movies')) || [];
  renderMovieList();

  // adiciona um evento de envio ao formulário para adicionar um novo filme à lista
  form.addEventListener('submit', (event) => {
    event.preventDefault();
    const movieTitle = document.querySelector('#input-movie-title').value;
    if (movieTitle) {
      // pesquisa o filme na API do OMDb
      searchMovie(movieTitle).then((movie) => {
        // adiciona o filme à lista de filmes
        movies.push(movie);
        localStorage.setItem('movies', JSON.stringify(movies));
        renderMovieList();
      });
    }
  });

  // função para pesquisar um filme na API do OMDb
  function searchMovie(title) {
    return fetch(`http://www.omdbapi.com/?apikey=${apiKey}&t=${encodeURIComponent(title)}`)
      .then((response) => response.json())
      .then((data) => {
        // verifica se houve algum resultado
        if (data.Response === 'True') {
          // retorna os dados do filme
          return {
            title: data.Title,
            poster_path: data.Poster
          };
        } else {
          // se não houver resultado, retorna null
          return null;
        }
      });
  }
 // função para renderizar a lista de filmes na página
 function renderMovieList() {
    movieListDiv.innerHTML = '';
    for (let i = 0; i < movies.length; i++) {
      const movie = movies[i];
      const movieDiv = document.createElement('div');

      // adiciona a verificação aqui
      if (movie && movie.title && movie.poster_path) {
        // cria um elemento img com o URL do poster do filme
        const posterImg = document.createElement('img');
        posterImg.src = movie.poster_path;
        posterImg.alt = movie.title + ' poster';
        movieDiv.appendChild(posterImg);

        // adiciona o título do filme ao elemento div
        movieDiv.innerHTML += ' ' + movie.title + ' ';
      } else {
        // aqui você pode exibir uma mensagem de erro ou um poster padrão
        const errorMessage = document.createElement('p');
        errorMessage.innerHTML = 'Dados do filme não disponíveis';
        movieDiv.appendChild(errorMessage);
      }

      // cria um botão "Excluir" para remover o filme da lista
      const deleteButton = document.createElement('button');
      deleteButton.innerHTML = 'Excluir';
      deleteButton.addEventListener('click', () => {
        movies.splice(i, 1);
        localStorage.setItem('movies', JSON.stringify(movies));
        renderMovieList();
      });
      movieDiv.appendChild(deleteButton);

      // adiciona o elemento div à lista de filmes
      movieListDiv.appendChild(movieDiv);
    }
  }
</script>
</body>
</html>